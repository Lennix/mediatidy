#!/usr/bin/env coffee

program = require 'commander'
Config = require '../lib/config'
Media = require '../lib/media'
colors = require 'colors'
async = require 'async'

# program
#   .option('-y, --yes', 'Make \'yes\' the default delete response (dangerous!)')

program.command('update')
  .description('look for for files and directories and add to mediatidy database')
  .action () ->
    media = new Media

    # Perform action in series with async
    async.series [
      (callback) ->
        media.setup ->
          callback()
      (callback) ->
        media.addFiles ->
          callback()
      (callback) ->
        media.exists ->
          callback()
      (callback) ->
        media.fileMetaUpdate ->
          callback()
      (callback) ->
        media.deleteCorrupt ->
          callback()
      (callback) ->
        media.deleteSamples ->
          callback()
      (callback) ->
        media.deleteOthers ->
          callback()
      (callback) ->
        media.deleteDupes ->
          callback()
    ], (err, results) ->
      throw err if err
      console.log 'Media update complete.'

program.parse process.argv

program.help() if program.args.length is 0
